---
import { Icon } from 'astro-icon/components';

type Translations = typeof import('../../i18n/es').default;
type ResultsContent = Translations['about']['results'];
interface Props {
  content: ResultsContent;
}
const { content } = Astro.props as Props;
---

<section
  class="w-full flex justify-center items-center gap-[73px] flex-col pt-14 pb-[120px] relative bg-primary-dark"
>
  <img
    src="/images/main/bg-pets.webp"
    alt="Fondo de Monarcas"
    width="1599"
    height="914"
    class="absolute w-full h-full inset-0 top-0 z-0 object-cover object-top"
    decoding="async"
    loading="lazy"
  />
  <Icon
    name={'ondulate'}
    class={'absolute -bottom-px h-10 w-auto md:w-full md:h-auto z-10 left-0 rotate-180'}
    style="color: #FFF"
  />
  <div
    class="w-full max-w-screen md:max-w-7xl flex flex-col justify-center items-center px-5 xl:px-0 gap-5"
  >
    <h2
      class="text-[32px] md:text-[40px] font-normal font-title leading-[120%] text-white text-center"
    >
      {content.title}
    </h2>
    <p
      class="text-[20px] md:text-[16px] leading-[130%] md:leading-[120%] font-normal text-center text-white"
      set:html={content.description}
    />
  </div>
  <div class="w-full">
    <style>
      .carousel-track {
        gap: 17px;
        align-items: stretch;
      }
      /* default: each slide takes full width (1 per view) */
      .carousel-slide {
        flex: 0 0 100%;
      }
      .carousel {
        overflow: hidden;
      }

      /* For the small-track (first track inside .carousel) show 2 slides per view
         on small screens >=640px and <768px */
      @media (min-width: 640px) and (max-width: 767.98px) {
        .carousel > .carousel-track:first-child .carousel-slide {
          flex: 0 0 50%;
        }
      }
    </style>

    <div class="carousel overflow-hidden">
      <!-- Track for md and below: each div is a separate slide -->
      <div class="carousel-track flex md:hidden">
        <!-- group A -->
        <div class="carousel-slide w-full h-[50vh]">
          <div
            class="w-full h-full grid grid-cols-3 gap-[17px] grid-rows-[4fr_5fr]"
          >
            <div
              class="relative overflow-hidden rounded-[20px] col-span-2 h-full"
            >
              <img
                src="/images/main/image-1-1.webp"
                alt="Imagen de Carousel 1"
                width="235"
                height="256"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px] h-full">
              <img
                src="/images/main/image-1-2.webp"
                alt="Imagen de Carousel 1"
                width="167"
                height="256"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px] h-full">
              <img
                src="/images/main/image-1-3.webp"
                alt="Imagen de Carousel 1"
                width="338"
                height="600"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div
              class="relative overflow-hidden rounded-[20px] col-span-2 h-full"
            >
              <img
                src="/images/main/image-1-4.webp"
                alt="Imagen de Carousel 1"
                width="283"
                height="311"
                class="absolute w-full h-full inset-0 z-0 object-cover object-bottom"
                loading="eager"
                decoding="async"
              />
            </div>
          </div>
        </div>
        <div class="carousel-slide w-full h-[50vh]">
          <div class="w-full h-full rounded-[20px] relative overflow-hidden">
            <img
              src="/images/main/image-2-1.webp"
              alt="Imagen de Carousel 2"
              width="729"
              height="588"
              loading="eager"
              decoding="async"
              class="absolute w-full h-full inset-0 z-0 object-cover"
            />
          </div>
        </div>
        <div class="carousel-slide w-full h-[50vh]">
          <div
            class="w-full h-full grid grid-cols-3 gap-[17px] grid-rows-[5fr_4fr]"
          >
            <div class="relative overflow-hidden rounded-[20px] col-span-2">
              <img
                src="/images/main/image-3-1.webp"
                alt="Imagen de Carousel 3"
                width="283"
                height="317"
                class="absolute w-full h-full inset-0 z-0 object-cover object-bottom"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px]">
              <img
                src="/images/main/image-3-2.webp"
                alt="Imagen de Carousel 3"
                width="339"
                height="600"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px]">
              <img
                src="/images/main/image-3-3.webp"
                alt="Imagen de Carousel 3"
                width="190"
                height="256"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px] col-span-2">
              <img
                src="/images/main/image-3-4.webp"
                alt="Imagen de Carousel 3"
                width="338"
                height="600"
                class="absolute w-full h-full inset-0 z-0 object-cover object-[center_70%]"
                loading="eager"
                decoding="async"
              />
            </div>
          </div>
        </div>
        <!-- group B (duplicate) -->
        <div class="carousel-slide w-full h-[50vh]">
          <div
            class="w-full h-full grid grid-cols-3 gap-[17px] grid-rows-[4fr_5fr]"
          >
            <div
              class="relative overflow-hidden rounded-[20px] col-span-2 h-full"
            >
              <img
                src="/images/main/image-1-1.webp"
                alt="Imagen de Carousel 1"
                width="235"
                height="256"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px] h-full">
              <img
                src="/images/main/image-1-2.webp"
                alt="Imagen de Carousel 1"
                width="167"
                height="256"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px] h-full">
              <img
                src="/images/main/image-1-3.webp"
                alt="Imagen de Carousel 1"
                width="338"
                height="600"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div
              class="relative overflow-hidden rounded-[20px] col-span-2 h-full"
            >
              <img
                src="/images/main/image-1-4.webp"
                alt="Imagen de Carousel 1"
                width="283"
                height="311"
                class="absolute w-full h-full inset-0 z-0 object-cover object-bottom"
                loading="eager"
                decoding="async"
              />
            </div>
          </div>
        </div>
        <div class="carousel-slide w-full h-[50vh]">
          <div class="w-full h-full relative overflow-hidden rounded-[20px]">
            <img
              src="/images/main/image-2-1.webp"
              alt="Imagen de Carousel 2"
              width="729"
              height="588"
              loading="eager"
              decoding="async"
              class="absolute w-full h-full inset-0 z-0 object-cover"
            />
          </div>
        </div>
        <div class="carousel-slide w-full h-[50vh]">
          <div
            class="w-full h-full grid grid-cols-3 gap-[17px] grid-rows-[5fr_4fr]"
          >
            <div class="relative overflow-hidden rounded-[20px] col-span-2">
              <img
                src="/images/main/image-3-1.webp"
                alt="Imagen de Carousel 3"
                width="283"
                height="317"
                class="absolute w-full h-full inset-0 z-0 object-cover object-bottom"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px]">
              <img
                src="/images/main/image-3-2.webp"
                alt="Imagen de Carousel 3"
                width="339"
                height="600"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px]">
              <img
                src="/images/main/image-3-3.webp"
                alt="Imagen de Carousel 3"
                width="190"
                height="256"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px] col-span-2">
              <img
                src="/images/main/image-3-4.webp"
                alt="Imagen de Carousel 3"
                width="338"
                height="600"
                class="absolute w-full h-full inset-0 z-0 object-cover object-[center_70%]"
                loading="eager"
                decoding="async"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Track for md and above: original structure -->
      <div class="carousel-track hidden md:flex">
        <!-- group A -->
        <div
          class="carousel-slide flex justify-center items-stretch gap-5 w-full h-[60vh]"
        >
          <div
            class="w-full md:w-[30%] h-full grid grid-cols-3 gap-[17px] grid-rows-[4fr_5fr]"
          >
            <div
              class="relative overflow-hidden rounded-[20px] col-span-2 h-full"
            >
              <img
                src="/images/main/image-1-1.webp"
                alt="Imagen de Carousel 1"
                width="235"
                height="256"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px] h-full">
              <img
                src="/images/main/image-1-2.webp"
                alt="Imagen de Carousel 1"
                width="167"
                height="256"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px] h-full">
              <img
                src="/images/main/image-1-3.webp"
                alt="Imagen de Carousel 1"
                width="338"
                height="600"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div
              class="relative overflow-hidden rounded-[20px] col-span-2 h-full"
            >
              <img
                src="/images/main/image-1-4.webp"
                alt="Imagen de Carousel 1"
                width="283"
                height="311"
                class="absolute w-full h-full inset-0 z-0 object-cover object-bottom"
                loading="eager"
                decoding="async"
              />
            </div>
          </div>
          <div
            class="w-full md:w-[40%] h-full rounded-[20px] relative overflow-hidden"
          >
            <img
              src="/images/main/image-2-1.webp"
              alt="Imagen de Carousel 2"
              width="729"
              height="588"
              loading="eager"
              decoding="async"
              class="absolute w-full h-full inset-0 z-0 object-cover"
            />
          </div>
          <div
            class="w-full md:w-[30%] h-full grid grid-cols-3 gap-[17px] grid-rows-[5fr_4fr]"
          >
            <div class="relative overflow-hidden rounded-[20px] col-span-2">
              <img
                src="/images/main/image-3-1.webp"
                alt="Imagen de Carousel 3"
                width="283"
                height="317"
                class="absolute w-full h-full inset-0 z-0 object-cover object-bottom"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px]">
              <img
                src="/images/main/image-3-2.webp"
                alt="Imagen de Carousel 3"
                width="339"
                height="600"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px]">
              <img
                src="/images/main/image-3-3.webp"
                alt="Imagen de Carousel 3"
                width="190"
                height="256"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px] col-span-2">
              <img
                src="/images/main/image-3-4.webp"
                alt="Imagen de Carousel 3"
                width="338"
                height="600"
                class="absolute w-full h-full inset-0 z-0 object-cover object-[center_70%]"
                loading="eager"
                decoding="async"
              />
            </div>
          </div>
        </div>

        <!-- group B (duplicate) -->
        <div
          class="carousel-slide flex justify-center items-stretch gap-5 w-full h-[60vh]"
        >
          <div
            class="w-full md:w-[30%] h-full grid grid-cols-3 gap-[17px] grid-rows-[4fr_5fr]"
          >
            <div
              class="relative overflow-hidden rounded-[20px] col-span-2 h-full"
            >
              <img
                src="/images/main/image-1-1.webp"
                alt="Imagen de Carousel 1"
                width="235"
                height="256"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px] h-full">
              <img
                src="/images/main/image-1-2.webp"
                alt="Imagen de Carousel 1"
                width="167"
                height="256"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px] h-full">
              <img
                src="/images/main/image-1-3.webp"
                alt="Imagen de Carousel 1"
                width="338"
                height="600"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div
              class="relative overflow-hidden rounded-[20px] col-span-2 h-full"
            >
              <img
                src="/images/main/image-1-4.webp"
                alt="Imagen de Carousel 1"
                width="283"
                height="311"
                class="absolute w-full h-full inset-0 z-0 object-cover object-bottom"
                loading="eager"
                decoding="async"
              />
            </div>
          </div>
          <div
            class="w-full md:w-[40%] h-full rounded-[20px] relative overflow-hidden"
          >
            <img
              src="/images/main/image-2-1.webp"
              alt="Imagen de Carousel 2"
              width="729"
              height="588"
              class="absolute w-full h-full inset-0 z-0 object-cover"
              loading="eager"
              decoding="async"
            />
          </div>
          <div
            class="w-full md:w-[30%] h-full grid grid-cols-3 gap-[17px] grid-rows-[5fr_4fr]"
          >
            <div class="relative overflow-hidden rounded-[20px] col-span-2">
              <img
                src="/images/main/image-3-1.webp"
                alt="Imagen de Carousel 3"
                width="283"
                height="317"
                class="absolute w-full h-full inset-0 z-0 object-cover object-bottom"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px]">
              <img
                src="/images/main/image-3-2.webp"
                alt="Imagen de Carousel 3"
                width="339"
                height="600"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px]">
              <img
                src="/images/main/image-3-3.webp"
                alt="Imagen de Carousel 3"
                width="190"
                height="256"
                class="absolute w-full h-full inset-0 z-0 object-cover"
                loading="eager"
                decoding="async"
              />
            </div>
            <div class="relative overflow-hidden rounded-[20px] col-span-2">
              <img
                src="/images/main/image-3-4.webp"
                alt="Imagen de Carousel 3"
                width="338"
                height="600"
                class="absolute w-full h-full inset-0 z-0 object-cover object-[center_70%]"
                loading="eager"
                decoding="async"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const tracks = document.querySelectorAll('.carousel-track');
        let track: HTMLElement | null = null;
        for (const t of tracks) {
          if (getComputedStyle(t).display !== 'none') {
            track = t as HTMLElement;
            break;
          }
        }
        if (!track) return;
        let slides = Array.from(
          track.querySelectorAll<HTMLElement>('.carousel-slide')
        );
        if (slides.length < 2) return;

        // Use Web Animations API for a seamless scroll based on actual slide width + gap
        let anim: Animation | null = null;
        const trackEl = track as HTMLElement;
        const speedPxPerSec = 50; // slower speed (px per second)

        function startAnim() {
          if (anim) anim.cancel();
          const first = slides[0];
          const slideRect = first.getBoundingClientRect();
          const slideWidth = Math.round(slideRect.width);
          if (!slideWidth) return;
          const trackStyle = getComputedStyle(trackEl);
          const gap = parseFloat(trackStyle.gap || '0') || 0;
          let distance = slideWidth + gap;
          if (slides.length > 3) {
            distance *= 3; // For small screens with 6 slides, move by 3 slides to loop seamlessly
          }
          const duration = Math.max(3000, (distance / speedPxPerSec) * 1000);

          anim = trackEl.animate(
            [
              { transform: 'translateX(0px)' },
              { transform: `translateX(-${distance}px)` },
            ],
            {
              duration,
              iterations: Infinity,
              easing: 'linear',
            }
          );

          // pause on hover of the carousel container (bind only once)
          const container = trackEl.closest('.carousel') as HTMLElement | null;
          if (container && container.dataset.carouselHoverBound !== '1') {
            container.addEventListener('mouseenter', () => anim?.pause());
            container.addEventListener('mouseleave', () => anim?.play());
            container.dataset.carouselHoverBound = '1';
          }
        }

        startAnim();
        window.addEventListener('resize', () => {
          if (anim) anim.cancel();
          // Re-select the visible track on resize
          for (const t of tracks) {
            if (getComputedStyle(t).display !== 'none') {
              track = t as HTMLElement;
              break;
            }
          }
          if (track) {
            const newSlides = Array.from(
              track.querySelectorAll<HTMLElement>('.carousel-slide')
            );
            // update slides so startAnim uses current visible track
            slides = newSlides;
            if (newSlides.length >= 2) {
              startAnim();
            }
          }
        });
      });
    </script>
  </div>
</section>
