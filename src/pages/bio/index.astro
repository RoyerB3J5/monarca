---
import { Icon } from 'astro-icon/components';
import SocialMedia from '../../components/SocialMedia.astro';
import LayoutSec from '../../layouts/LayoutSec.astro';
import SaveContact from '../../components/SaveContact.astro';
const content = [
  {
    title: 'WhatsApp',
    link: 'https://wa.link/auznqr',
  },
  {
    title: 'Review',
    link: 'https://g.page/r/CdPheJkrNfc1EBM/review',
  },
  {
    title: 'Website',
    link: '/',
  },
  {
    title: 'TikTok',
    link: 'https://www.tiktok.com/@monarcagrooming',
  },
  {
    title: 'Instagram',
    link: 'https://www.instagram.com/monarca.pets.spa/',
  },
  {
    title: 'Facebook',
    link: 'https://www.facebook.com/Grooming.Monarca.spa/',
  },
];
---

<LayoutSec>
  <img
    src="/images/share-dark.svg"
    alt="Compartir"
    class="absolute top-6 right-6  w-6 h-6 cursor-pointer share-btn"
  />
  <section
    class="w-full flex flex-col justify-center items-center gap-8 pt-11 pb-5 px-6 max-w-[500px]"
  >
    <div class="w-full flex flex-col justify-center items-center gap-[21px]">
      <a
        href="/"
        aria-label="Ir a la p√°gina principal"
        title="Inicio - Monarcas"
      >
        <img
          src="/images/logo-shapehub.webp"
          alt="Logo de Monarcas - Mobile Pet Grooming"
          width="1280"
          height="810"
          class="cursor-pointer w-[250px] md:w-[300px] h-auto"
        />
      </a>
      <div class="flex flex-col justify-center items-center">
        <h1 class="text-[24px] leading-[175%] font-title">@MonarcaMobilePetGrooming</h1>
        <div
          class="flex justify-center items-center gap-[3px] mt-0.5 mb-[11px]"
        >
          <Icon name={'map'} class={'w-[9px] h-[11px] text-secondary'} />
          <p class="text-[12px] leading-[22px] font-medium">Florida, USA</p>
        </div>
        <p class="text-[16px] leading-[18px] text-center font-medium">
          Mobile pet grooming in Florida üêæ <br/> üê∂ Quality care for your furry friends! üåü
        </p>
      </div>
      <SocialMedia />
    </div>
    <div class="w-full flex flex-col justify-center items-center gap-3">
      {
        content.map((item) => (
          <a class="w-full" href={item.link}>
            <div
              class={`w-full  py-2.5 h-[47px] rounded-[10px] text-white flex justify-center items-center ${item.title === 'Our Services' ? 'animate-shake' : ''} bg-primary hover:bg-primary/90 cursor-pointer`}
            >
              <p class="text-[14px] font-medium leading-[140%]">{item.title}</p>
            </div>
          </a>
        ))
      }
      <button class="w-full bg-secondary py-2.5 h-[47px] rounded-[10px] text-white flex justify-center items-center text-[14px] font-medium leading-[140%] cursor-pointer" id="open-contact-panel">
        Save Contact
      </button>
    </div>
    <div class="flex flex-col justify-center items-center gap-[9px] ">
      <p class="text-[14px] font-normal leading-[140%] text-[#888]">
        Powered by
      </p>
      <a href="
        https://inkshapegroup.com
        ">
        <img
          src="/images/footer-logo.webp"
          alt="Imagen del Footer"
          width="3745"
          height="996"
          class="w-[110px] h-[29px] cursor-pointer"
        />
      </a>
    </div>
  </section>
  <div class="fixed bg-black/30 w-screen h-screen top-0 left-0 flex items-end" style="z-index:9999; pointer-events: none;" id="contact-panel">
    <div id="contact-panel-inner" class="w-full h-[80%] rounded-t-[20px] bg-white relative flex flex-col justify-start items-center gap-8 py-6 transform translate-y-full transition-transform duration-300 ease-in-out" style="z-index:10000; pointer-events: auto;">
      <img src="/images/share.svg" alt="Compartir" class="absolute top-5 left-5 w-6 h-6 cursor-pointer share-btn">
      <img src="/images/equis-black.svg" alt="Cerrar panel" class="absolute top-5 right-5 w-5 h-5 cursor-pointer" id="close-panel">
      <p class="text-[16px]">Monarca - Mobile Pet Grooming</p>
      <div class="flex flex-col justify-center items-start gap-8 mt-3">
        <p class="text-[18px] font-bold mb-5 w-full text-center">Monarca - Mobile Pet Grooming</p>
        <div class="flex justify-center items-center gap-5 text-[16px] font-medium">
          <p class="font-bold text-[22px]">@</p>
          <a href="https://mail.google.com/mail/?view=cm&fs=1&to=Monarca.grooming@gmail.com">Monarca.grooming@gmail.com</a>
        </div>
        <div class="flex justify-center items-center gap-5 text-[16px] font-medium">
          <img src="/images/phone.svg" alt="Telefono" class="w-6 h-6">
          <a href="tel:+19548684929">+1 (954) 868-4929</a>
        </div>
        <div class="flex justify-center items-center gap-5 text-[16px] font-medium">
          <img src="/images/map-1.svg" alt="Ubicaci√≥n" class="w-6 h-6">
          <a >Florida, Usa</a>
        </div>
        <div class="flex justify-center items-center gap-5 text-[16px] font-medium">
          <img src="/images/web.svg" alt="Telefono" class="w-6 h-6">
          <a href="/">monarcagrooming.com</a>
        </div>
        <SaveContact />
      </div>
    </div>
  </div>
</LayoutSec>
<script is:inline>
  const openContactPanelButton = document.getElementById('open-contact-panel');
  const contactPanel = document.getElementById('contact-panel');
  const contactPanelInner = document.getElementById('contact-panel-inner');
  const closePanelButton = document.getElementById('close-panel');

  // guard: si no existen elementos, no hacemos nada
  if (!openContactPanelButton || !contactPanel || !contactPanelInner) {
    // nothing to do
  } else {
    const TRANSITION_MS = 350; // slightly larger than duration-300

    let scrollY = 0;
    let previousBodyStyles = {};
    function showPanel() {
      contactPanel.style.display = 'flex';
      contactPanel.style.pointerEvents = 'auto';
      // lock scroll by fixing body in place (works better on mobile)
      scrollY = window.scrollY || window.pageYOffset || 0;
      previousBodyStyles = {
        position: document.body.style.position || '',
        top: document.body.style.top || '',
        left: document.body.style.left || '',
        right: document.body.style.right || '',
        width: document.body.style.width || '',
        overflow: document.body.style.overflow || '',
      };
      document.body.style.position = 'fixed';
      document.body.style.top = `-${scrollY}px`;
      document.body.style.left = '0';
      document.body.style.right = '0';
      document.body.style.width = '100%';
      // force a reflow so the transition runs
      void contactPanelInner.offsetWidth;
      contactPanelInner.classList.remove('translate-y-full');
      contactPanelInner.classList.add('translate-y-0');
    }

    function completeHide() {
      contactPanel.style.display = 'none';
      contactPanel.style.pointerEvents = 'none';
      // restore previous body styles and scroll position
      document.body.style.position = previousBodyStyles.position || '';
      document.body.style.top = previousBodyStyles.top || '';
      document.body.style.left = previousBodyStyles.left || '';
      document.body.style.right = previousBodyStyles.right || '';
      document.body.style.width = previousBodyStyles.width || '';
      document.body.style.overflow = previousBodyStyles.overflow || '';
      window.scrollTo(0, scrollY);
    }

    function hidePanel() {
      // slide down
      contactPanelInner.classList.remove('translate-y-0');
      contactPanelInner.classList.add('translate-y-full');

      // Wait for transitionend, but also use a timeout fallback
      let done = false;
      function onTransition() {
        if (done) return;
        done = true;
        completeHide();
        contactPanelInner.removeEventListener('transitionend', onTransition);
      }

      contactPanelInner.addEventListener('transitionend', onTransition);
      // fallback in case transitionend doesn't fire
      setTimeout(() => onTransition(), TRANSITION_MS + 100);
    }

    openContactPanelButton.addEventListener('click', showPanel);

    // Share buttons: open native share sheet when supported
    const shareButtons = document.querySelectorAll('.share-btn');
    if (shareButtons && shareButtons.length) {
      shareButtons.forEach((btn) => {
        btn.addEventListener('click', async (e) => {
          e.stopPropagation();
          const shareData = {
            title: 'Mg Riox Plumbing',
            text: 'Mg Riox Plumbing ‚Äî professional plumbing services in Atlanta and surrounding areas',
            url: window.location.href,
          };

          if (navigator.share) {
            try {
              await navigator.share(shareData);
              return;
            } catch (err) {
              // user cancelled or error; fall through to clipboard fallback
              console.warn('share failed or cancelled', err);
            }
          }

          // Fallback: copy URL to clipboard and notify user
          try {
            await navigator.clipboard.writeText(window.location.href);
            // small user feedback; prefer a non-blocking toast in the future
            alert('Enlace copiado al portapapeles. Pega y comparte donde quieras.');
          } catch (err) {
            // last resort: open native share via mailto as a helper
            console.warn('clipboard write failed', err);
          }
        });
      });
    }

    // close button (may be null if removed inside component)
    if (closePanelButton) closePanelButton.addEventListener('click', hidePanel);

    // allow clicking the backdrop (outside inner panel) to close
    contactPanel.addEventListener('click', (e) => {
      if (e.target === contactPanel) hidePanel();
    });

    // Inicialmente ocultar el panel
    contactPanel.style.display = 'none';
    contactPanel.style.pointerEvents = 'none';
  }
</script>